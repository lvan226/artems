$slickGreen = false;

function greenSlider() {
  if ($(window).width() <= 1090) {
    if (!$slickGreen) {
      $(".rate__row").slick({
        dots: false,
        arrows: true,
        slidesToShow: 1,
        slidesToScroll: 1,
      });
      $slickGreen = true;
    }
  } else if ($(window).width() > 1090) {
    if ($slickGreen) {
      $('.rate__row').slick('unslick');
      $slickGreen = false;
    }
  }
};

$slickGreen2 = false;

function greenSlider2() {
  if ($(window).width() <= 1280) {
    if (!$slickGreen2) {
      $(".workers__item-wrap").slick({
        dots: false,
        arrows: true,
        slidesToShow: 4,
        slidesToScroll: 1,
        responsive: [{
            breakpoint: 1000,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 1,
            }
          },
          {
            breakpoint: 800,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 551,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 451,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 1,
            }
          }
        ]
      });
      $slickGreen2 = true;
    }
  } else if ($(window).width() > 1280) {
    if ($slickGreen2) {
      $('.workers__item-wrap').slick('unslick');
      $slickGreen2 = false;
    }
  }
};

function modalActive(id, modal) {
  $(id).on('click', function () {
    var overlay = '<div class="modal__overlay"></div>';
    $(modal).addClass('active');
    $('body').append(overlay);
    $('.modal__close').on('click', function () {
      $(modal).removeClass('active');
      $('.modal__overlay').detach();
    });
  });
}

$(function () {
  $('.results-case').slick({
    slidesToShow: 1,
    speed: 400,
  });

  $('.menu__burger').on('click', function () {
    $('.menu__list').toggleClass('active');
    $(this).toggleClass('active');
    $('body').toggleClass('hidden');
  });

  $(document).scroll(function () {
    var scroll_status = $(document).scrollTop();
    if (scroll_status > 1000) {
      $('.menu').addClass('fixed');
      $('.header').addClass('fixed');
    } else {
      $('.menu').removeClass('fixed');
      $('.header').removeClass('fixed');
    }
  });


  $("#menu").on("click", "a", function (event) {
    //отменяем стандартную обработку нажатия по ссылке
    event.preventDefault();

    //забираем идентификатор бока с атрибута href
    var id = $(this).attr('href'),

      //узнаем высоту от начала страницы до блока на который ссылается якорь
      top = $(id).offset().top;
    if ($(window).width() < 600) {
      top -= 100;
    } else {
      top -= 160;
    }
    //анимируем переход на расстояние - top за 1500 мс

    $('body,html').animate({
      scrollTop: top
    }, 1000);
    $('.menu__list').toggleClass('active');
    $('.menu__burger').toggleClass('active');
    $('body').toggleClass('hidden');
  });
  $("#footer__list, #footer__list2").on("click", "a", function (event) {
    //отменяем стандартную обработку нажатия по ссылке
    event.preventDefault();

    //забираем идентификатор бока с атрибута href
    var id = $(this).attr('href'),

      //узнаем высоту от начала страницы до блока на который ссылается якорь
      top = $(id).offset().top;
    if ($(window).width() < 600) {
      top -= 100;
    } else {
      top -= 160;
    }
    //анимируем переход на расстояние - top за 1500 мс

    $('body,html').animate({
      scrollTop: top
    }, 1000);
  });

  modalActive('.menu__contact-btn', '#modal2');
  modalActive('.header__btn', '#modal1');
  modalActive('.promotion__btn', '#modal3');
  modalActive('.rate__item-btn', '#modal4');
  modalActive('.cost__btn', '#modal4');
  modalActive('.remember__btn', '#modal5');

  $('.phone-input').inputmask("+7(999)999-99-99");

  var maxLen = 20;
  $('.modal input').keyup(function () {
    var $this = $(this);
    if ($this.val().length > maxLen) {
      $this.val($this.val().substr(0, maxLen));
    }
  });

  $('.label-hover').hover(
    function () {
      if ($(this).children('input').val().length <= 0) {
        $(this).addClass('active');
      }
    },
    function () {
      if ($(this).find('input').val().length <= 0) {
        $(this).removeClass('active');
      }
    });
  $('.label-hover input').keyup(function () {
    if ($(this).val().length >= 0) {
      $(this).parent('.label-hover').addClass('active');
    }
    if ($(this).val().length <= 0) {
      $(this).parent('.label-hover').removeClass('active');
    }
  });

  //   $('#form-modal').submit(function() {
  //     $.ajax({
  //         type: 'POST',
  //         url: 'mail2.php',
  //         data: $(this).serialize()
  //     }).done(function() {
  //       alert("Спасибо за заявку!");
  //       $('#modal5').empty();
  //     });
  //     return false;
  // }); 

  //E-mail Ajax Send
  function sendForm(modal, flag) {
    var form = $(modal).children('form');
    $(form).submit(function () { //Change
      var th = $(this);
      var close = '<div class="modal__close"><span></span><span></span></div>';
      var smm = '<div class="modal__suptitle">SMM-агенство Артёма Алексеева</div>';
      var thank = '<div class="thanks">Спасибо за заявку!</div>';
      var result = close + smm + thank;
      $.ajax({
        type: "POST",
        url: "../mail2.php", //Change
        data: th.serialize()
      }).done(function () {
        if (flag == 1) {
          var name = "Бонус";
          var uri = '../images/cost-bg.jpg';
          var link = document.createElement("a");
          $(link).addClass('nons');
          link.download = name;
          link.href = uri;
          link.click();
        }
        setTimeout(function () {
          // Done Functions
          $(modal).empty();
          $(modal).append(result);
          $(modal).children('.modal__close').on('click', function () {
            $(modal).removeClass('active');
            $('.modal__overlay').detach();
          });
          th.trigger("reset");
        }, 200);
      });
      return false;
    });
  }

  sendForm('#modal1');
  sendForm('#modal2');
  sendForm('#modal3');
  sendForm('#modal4');
  sendForm('#modal5', 1);
  
  // $("form").submit(function () { //Change
  //   var th = $(this).children('form');
  //   $.ajax({
  //     type: "POST",
  //     url: "../mail2.php", //Change
  //     data: th.serialize()
  //   }).done(function () {
  //     alert("Thank you!");
  //     setTimeout(function () {
  //       // Done Functions
  //       th.trigger("reset");
  //     }, 1000);
  //   });
  //   return false;
  // });

  greenSlider();
  greenSlider2();
});

$(window).on('resize', function () {
  greenSlider();
  greenSlider2();
});